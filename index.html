<!DOCTYPE html>
<html lang="en">


<head>

  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>

<script>
const supabaseClient = supabase.createClient(
  "https://yffplpmnolyyvvklcxev.supabase.co",
  "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InlmZnBscG1ub2x5eXZ2a2xjeGV2Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NzA3ODAwNTUsImV4cCI6MjA4NjM1NjA1NX0.AdOHKrrDoRmDUfCcL3KWrJKFxcBKgQZkvmxluo0WRVk"
);
</script>

  <!-- Google tag (gtag.js) -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-Z9KTYNYN95"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-Z9KTYNYN95');
</script>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
   <link rel="canonical" href="https://ceboardexamgenerator.com">
<meta name="robots" content="index, follow">
  <title>CE Board Exam Generator</title>
  <meta name="description" content="Generate randomized Civil Engineering board-style exams with topic solutions and downloadable materials." />
  <meta name="keywords" content="CE board exam, free beam calculator, engineering randomizer, structural, hydraulics, geotech, PSAD, MSTC, HGE" />
  <meta name="google-site-verification" content="nEC3RgAcPkF2rBxJZnYyUMY6QNCIkgWBROg85WmevoM" />
  <link rel="icon" href="assets/webicon.png" type="image/png" />
  <link rel="stylesheet" href="style.css">
  <meta property="og:title" content="CE Board Exam Randomizer" />
  <meta property="og:description" content="Generate randomized CE board-style exams instantly!" />
  <meta property="og:image" content="https://ceboardexamgenerator.com/assets/preview.png" />
  <meta property="og:url" content="https://ceboardexamgenerator.com" />
  <meta property="og:type" content="website" />
  <meta name="google-adsense-account" content="ca-pub-2265275210848597">

<script>
/**
 * PREMIUM + SINGLE-DEVICE (PREMIUM ONLY, MAGIC-LINK ONLY (FLOATING LICENSE))
 *
 * DB: profiles.current_session_id  (single active device token for PREMIUM users only)
 * Local: localStorage.device_session_id
 *
 * Rules (PREMIUM only):
 * 1) If current_session_id is NULL -> first premium device binds it.
 * 2) If current_session_id exists and mismatches local token -> DENY (sign out)
 *    UNLESS user arrived via a magic-link recovery callback (?recovery=1 + auth callback),
 *    in which case we rotate the DB token to this device (takeover) and all other devices get kicked.
 *
 * IMPORTANT:
 * - Password login MUST NOT rotate on mismatch. Only the magic-link recovery callback can override.
 * - Non-premium users should NOT be device-locked at all (no DB writes to current_session_id).
 */

function setPremiumFlag(isPremium) {
  document.documentElement.dataset.premium = isPremium ? "true" : "false";
}

function loadAds() {
  if (document.querySelector('script[data-adsbygoogle="1"]')) return;
  const ads = document.createElement("script");
  ads.src = "https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-2265275210848597";
  ads.async = true;
  ads.crossOrigin = "anonymous";
  ads.dataset.adsbygoogle = "1";
  document.head.appendChild(ads);
}

function setAuthStatus(msg, isError = false) {
  const el = document.getElementById("logoutAllStatus");
  if (!el) return;
  el.textContent = msg || "";
  el.style.color = isError ? "#b91c1c" : "#166534";
}
function setLogoutStatus(msg, isError = false) { setAuthStatus(msg, isError); }

// --- helpers ---
async function ensureProfileRow(user) {
  // Insert-only; NEVER touch is_premium from client code
  try {
    await supabaseClient.from("profiles").insert({ id: user.id, email: user.email });
  } catch (e) {
    // ignore duplicates / RLS limitations
  }
}

async function fetchProfile(userId) {
  const { data: profile, error } = await supabaseClient
    .from("profiles")
    .select("is_premium, current_session_id")
    .eq("id", userId)
    .single();

  if (error || !profile) return { profile: null, error: error || new Error("profile_missing") };
  return { profile, error: null };
}

function safeUUID() {
  try {
    if (window.crypto && typeof window.crypto.randomUUID === "function") return window.crypto.randomUUID();
  } catch (_) {}
  return "sid_" + Math.random().toString(36).slice(2) + "_" + Date.now().toString(36);
}

function getOrCreateLocalDeviceToken() {
  let t = null;
  try { t = localStorage.getItem("device_session_id"); } catch (_) {}
  if (!t) {
    t = safeUUID();
    try { localStorage.setItem("device_session_id", t); } catch (_) {}
  }
  return t;
}

function clearLocalDeviceToken() {
  try { localStorage.removeItem("device_session_id"); } catch (_) {}
}

async function setDbDeviceToken(userId, token) {
  const { error } = await supabaseClient
    .from("profiles")
    .update({ current_session_id: token })
    .eq("id", userId);
  return { ok: !error, error };
}

function isMagicLinkCallbackUrl(u) {
  // PKCE callback: ?code=...
  // Implicit callback: #access_token=...
  // Token links: ?token=... (some setups)
  return (
    u.searchParams.has("code") ||
    u.searchParams.has("token") ||
    u.searchParams.has("type") ||
    (u.hash && u.hash.includes("access_token="))
  );
}




function magicIntentIsFresh() {
  try {
    const ts = Number(localStorage.getItem("magic_intent_ts") || "0");
    if (!ts) return false;
    if (Date.now() - ts > 10 * 60 * 1000) { // 10 minutes
      localStorage.removeItem("magic_intent_ts");
      return false;
    }
    return true;
  } catch (e) { return false; }
}

function signedInEventIsFresh() {
  try {
    const ts = Number(sessionStorage.getItem("signed_in_ts") || "0");
    if (!ts) return false;
    if (Date.now() - ts > 10 * 60 * 1000) { // 10 minutes
      sessionStorage.removeItem("signed_in_ts");
      return false;
    }
    return true;
  } catch (e) { return false; }
}

async function handleAuthCallbackIfPresent() {
  const u = new URL(window.location.href);

  const isCallback = isMagicLinkCallbackUrl(u);

  // Exchange PKCE code if present
  if (u.searchParams.has("code")) {
    try {
      await supabaseClient.auth.exchangeCodeForSession(window.location.href);
    } catch (e) {
      console.warn("exchangeCodeForSession skipped:", e?.message || e);
    }
  }

  // If we arrived via a magic link callback, mark this tab as "just authenticated" (10 min)
  if (isCallback) {
    try { sessionStorage.setItem("just_authed_ts", String(Date.now())); } catch (e) {}
  }

  // Clean URL (remove auth-only params)
  if (u.searchParams.has("code") || u.searchParams.has("t") || u.searchParams.has("type") || u.searchParams.has("token")) {
    u.searchParams.delete("code");
    u.searchParams.delete("t");
    u.searchParams.delete("type");
    u.searchParams.delete("token");
    if (u.hash && u.hash.includes("access_token=")) u.hash = "";
    window.history.replaceState({}, "", u.toString());
  }

  return { isCallback };
}

let __authInitRunning = false;
async function initAuthAndPremium() {
  if (__authInitRunning) return;
  __authInitRunning = true;

  // Default CLOSED until verified (prevents ‚Äústuck premium‚Äù UI)
  setPremiumFlag(false);

  try {
    const { isCallback } = await handleAuthCallbackIfPresent();

    let justAuthed = false;
    try {
      const ts = Number(sessionStorage.getItem("just_authed_ts") || "0");
      justAuthed = !!(ts && (Date.now() - ts < 10 * 60 * 1000));
    } catch (e) {}
    justAuthed = justAuthed || isCallback || signedInEventIsFresh() || magicIntentIsFresh();
const { data: { user } } = await supabaseClient.auth.getUser();

    if (!user) {
      loadAds();
      return;
    }

    await ensureProfileRow(user);

    const { profile, error } = await fetchProfile(user.id);
    if (error || !profile) {
      clearLocalDeviceToken();
      try { await supabaseClient.auth.signOut(); } catch (_) {}
      loadAds();
      return;
    }

    // NON-PREMIUM: no device lock, just ads
    if (!profile.is_premium) {
      setPremiumFlag(false);
      loadAds();
      return;
    }

    // PREMIUM: enforce single device
    const localToken = getOrCreateLocalDeviceToken();
    const dbToken = profile.current_session_id;

    // First bind
    if (!dbToken) {
      const bound = await setDbDeviceToken(user.id, localToken);
      if (!bound.ok) {
        setAuthStatus("Device lock failed: " + (bound.error?.message || "unknown error"), true);
        setPremiumFlag(false);
        try { await supabaseClient.auth.signOut(); } catch (_) {}
        loadAds();
        return;
      }
      setAuthStatus("This device is now active.");
      try { sessionStorage.removeItem("just_authed_ts"); } catch (e) {}
      try { sessionStorage.removeItem("signed_in_ts"); } catch (e) {}
      try { localStorage.removeItem("magic_intent_ts"); } catch (e) {}
      setPremiumFlag(true);
      return;
    }

    // Match -> OK
    if (dbToken === localToken) {
      setPremiumFlag(true);
      return;
    }

    // Mismatch -> only allow takeover if this page load is a fresh magic-link callback (floating license move)
    if (!justAuthed) {
      setPremiumFlag(false);
      clearLocalDeviceToken();
      try { await supabaseClient.auth.signOut(); } catch (_) {}
      alert("This premium account is active on another device.\n\nSend a new magic link on this device to switch.");
      loadAds();
      return;
    }

    // Takeover: rotate license to THIS device
    const rotated = await setDbDeviceToken(user.id, localToken);
    if (!rotated.ok) {
      setAuthStatus("Could not activate this device: " + (rotated.error?.message || "unknown error"), true);
      setPremiumFlag(false);
      try { await supabaseClient.auth.signOut(); } catch (_) {}
      loadAds();
      return;
    }

    setAuthStatus("This device is now active. Other devices will lose premium on refresh.");
    try { sessionStorage.removeItem("just_authed_ts"); } catch (e) {}
    try { sessionStorage.removeItem("signed_in_ts"); } catch (e) {}
    try { localStorage.removeItem("magic_intent_ts"); } catch (e) {}
    setPremiumFlag(true);
    return;
} finally {
    __authInitRunning = false;
  }
}

// Run once
window.addEventListener("DOMContentLoaded", initAuthAndPremium);

// Re-check on auth changes
supabaseClient.auth.onAuthStateChange((event) => {
  // In this page we use magic-link only, so SIGNED_IN means user just clicked a magic link on THIS device.
  if (event === "SIGNED_IN") {
    try { sessionStorage.setItem("signed_in_ts", String(Date.now())); } catch (e) {}
  }
  if (event === "SIGNED_OUT") {
    try { sessionStorage.removeItem("signed_in_ts"); } catch (e) {}
    try { sessionStorage.removeItem("just_authed_ts"); } catch (e) {}
  }
  setTimeout(initAuthAndPremium, 0);
});

// Re-check when tab becomes active
document.addEventListener("visibilitychange", () => {
  if (!document.hidden) initAuthAndPremium();
});

// Re-check periodically so other devices get kicked without needing hard reload loops
setInterval(() => {
  if (!document.hidden) initAuthAndPremium();
}, 20000);

// Faculty gate helper (keeps your existing behavior)
async function tryEnterFacultyMode() {
  await initAuthAndPremium();
  const isPremium = document.documentElement.dataset.premium === "true";
  if (isPremium) return true;
  if (typeof showPremiumGate === "function") showPremiumGate();
  else alert("Premium feature.");
  return false;
}
</script>


<!-- Font: Google Fonts -->
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">

  <!-- Icons: Font Awesome -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">

  <!-- Animations: Animate.css -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/4.1.1/animate.min.css">

  <!-- Optional: Bootstrap Icons -->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.css">

  <!-- Optional: Normalize for cross-browser consistency -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/normalize/8.0.1/normalize.min.css">
<script>
  window.MathJax = {
    tex: { inlineMath: [['$', '$']], displayMath: [['$$', '$$']] },
    options: { skipHtmlTags: ['script','noscript','style','textarea','pre','code'] }
  };
</script>
<script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>

<style>
  body {
    font-family: 'Inter', sans-serif;
    margin: 0;
    padding-top: 70px;
    background-color: #f5f5f5;
    color: #000;
    -webkit-font-smoothing: antialiased;
    -moz-osx-font-smoothing: grayscale;
    transition: background-color 0.3s, color 0.3s;
  }

  .dark-mode {
    background-color: #121212;
    color: #f1f1f1;
  }

  header {
    background-color: #18398A;
    padding: 10px 20px;
    color: white;
    display: flex;
    align-items: center;
    position: fixed;
    top: 0;
    left: 0;
    right: 0;
    height: 60px;
    z-index: 999;
    box-shadow: 0 2px 8px rgba(0, 0, 0, 0.2);
    transition: background-color 0.3s;
  }

  .dark-mode header {
    background-color: #1f1f1f;
  }

  header img.logo {
    height: 40px;
    margin-right: 10px;
  }

  header h1 {
    font-size: 20px;
    margin: 0;
    flex-grow: 1;
    color: #fff !important;
  }

  nav {
    position: absolute;
    top: 60px;
    left: 10px;
    background-color: #18398A;
    border-radius: 8px;
    padding: 10px;
    z-index: 1000;
    box-shadow: 0 4px 12px rgba(0,0,0,0.3);
    display: none;
  }

  .dark-mode nav {
    background-color: #2a2a2a;
  }

  header:hover nav {
    display: block;
  }

  .menu-list {
    list-style: none;
    margin: 0;
    padding: 0;
  }

  .menu-list li {
    position: relative;
  }

  .menu-list a {
    display: block;
    color: white;
    padding: 8px 12px;
    border-radius: 4px;
    text-decoration: none;
    transition: background-color 0.2s ease-in-out;
  }

  .menu-list a:hover {
    background-color: #3366cc;
  }

  .dropdown:hover .submenu {
    display: block;
  }

  .submenu {
    display: none;
    position: absolute;
    left: 100%;
    top: 0;
    background-color: #0e2a6d;
    padding: 0;
    border-radius: 5px;
    min-width: 220px;
    list-style: none;
  }

  .submenu li {
    list-style: none;
  }

  .submenu li::marker {
    display: none;
  }

  .submenu li a {
    color: #fff;
    padding: 8px 12px;
    display: block;
    white-space: nowrap;
  }

  .submenu li a:hover {
    background-color: #5588dd;
  }

  .dark-mode .submenu {
    background-color: #333;
  }

  .menu-btn {
    cursor: pointer;
    font-size: 24px;
    background: none;
    border: none;
    color: white;
    margin-right: 10px;
  }

  main {
    display: flex;
    flex-wrap: wrap;
    padding: 30px 10px;
    gap: 20px;
    max-width: 1400px;
    margin: auto;
  }

  .left-column {
    flex: 2.5;
    min-width: 400px;
  }

  .right-column {
    flex: 1;
    min-width: 280px;
  }

  .box {
    background-color: white;
    border-radius: 10px;
    padding: 20px;
    margin-bottom: 20px;
    box-shadow: 0 0 10px rgba(0,0,0,0.1);
    transition: background-color 0.3s, color 0.3s;
  }

  .dark-mode .box {
    background-color: #1e1e1e;
    color: #f1f1f1;
  }

  h2, h3, h4 {
    color: #18398A;
    margin-top: 0;
  }

  .dark-mode h2,
  .dark-mode h3,
  .dark-mode h4 {
    color: #84aaff;
  }

  .exam-btn {
    background-color: #2962ff;
    border: none;
    color: white;
    padding: 10px 20px;
    font-size: 16px;
    border-radius: 6px;
    cursor: pointer;
    margin-top: 10px;
    transition: background-color 0.3s;
  }

  .exam-btn:hover {
    background-color: #1c4ed8;
  }

  .exam-btn.pulse {
    font-size: 18px;
    padding: 14px 32px;
    background-color: #2962ff;
    color: white;
    border: none;
    border-radius: 8px;
    cursor: pointer;
    animation: pulse 1.5s infinite;
    margin-top: 20px;
  }

  .exam-btn.pulse:hover {
    background-color: #1c4ed8;
    transform: scale(1.05);
    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);
  }

  .exam-main-panel {
    padding: 50px 30px;
    text-align: center;
    border: 3px solid #2962ff;
    background: linear-gradient(to bottom right, #e6ecff, #ffffff);
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    transition: background 0.3s, color 0.3s;
  }

  .dark-mode .exam-main-panel {
    background: #222;
    color: #f1f1f1;
  }

  .main-title {
    font-size: 36px;
    color: #18398A;
    margin-bottom: 10px;
    transition: color 0.3s ease, transform 0.2s ease;
  }

  .dark-mode .main-title {
    color: #82b4ff;
  }

  .main-subtitle {
    font-size: 18px;
    color: #333;
    margin-bottom: 20px;
    transition: color 0.3s ease, transform 0.2s ease;
  }

  .dark-mode .main-subtitle {
    color: #ccc;
  }

  .highlight-box {
    background-color: #ffeeba;
    border-left: 5px solid #ffc107;
    padding: 10px;
    margin-bottom: 20px;
    font-weight: bold;
  }
/* ===== Correct Answer Highlight ===== */
.highlight-answer {
  color: #ff3b3b;                 /* brighter red */
  font-weight: 700;
  padding: 2px 6px;
  border-radius: 6px;
}

/* Dark mode enhancement */
body.dark-mode .highlight-answer {
  color: #ff6b6b;                 /* lighter red for dark bg */
  background: rgba(255, 0, 0, 0.15);
  box-shadow: 0 0 6px rgba(255, 80, 80, 0.6);
}

/* [ANS] tag */
.answer-flag {
  margin-left: 8px;
  font-size: 0.85em;
  font-weight: 700;
  letter-spacing: 0.5px;
}

/* Dark mode ANS badge */
body.dark-mode .answer-flag {
  color: #ffd166;                 /* gold/yellow = readable */
  background: rgba(255, 209, 102, 0.18);
  padding: 2px 6px;
  border-radius: 6px;
}

  .dark-mode .highlight-box {
    background-color: #554400;
    border-left: 5px solid #ffcc00;
    color: #fff8c4;
  }

  footer {
    text-align: center;
    background-color: #e9ebf0;
    padding: 20px;
    font-size: 14px;
    color: #444;
  }

  .dark-mode footer {
    background-color: #1a1a1a;
    color: #bbb;
  }

  /* Fix dark mode hover and text */
  body.dark-mode nav .menu-list a {
    color: white !important;
  }

  body.dark-mode nav .menu-list a:hover {
    background-color: #3366cc;
    color: white !important;
  }

  /* General link colors */
  a {
    color: #2962ff;
    text-decoration: none;
  }

  a:hover {
    text-decoration: underline;
  }

  .dark-mode a {
    color: #82b4ff;
  }

  .switch {
    position: relative;
    display: inline-block;
    width: 46px;
    height: 26px;
  }

  .switch input {
    opacity: 0;
    width: 0;
    height: 0;
  }

  .slider {
    position: absolute;
    cursor: pointer;
    top: 0; left: 0;
    right: 0; bottom: 0;
    background-color: #ccc;
    transition: 0.4s;
    border-radius: 26px;
  }

  .slider:before {
    position: absolute;
    content: 'üåô';
    height: 22px;
    width: 22px;
    left: 2px;
    bottom: 2px;
    background-color: white;
    border-radius: 50%;
    transition: 0.4s;
    font-size: 14px;
    text-align: center;
    line-height: 22px;
  }

  input:checked + .slider {
    background-color: #2196F3;
  }

  input:checked + .slider:before {
    transform: translateX(20px);
    content: '‚òÄÔ∏è';
  }

  @keyframes pulse {
    0% { box-shadow: 0 0 0 0 rgba(41, 98, 255, 0.6); }
    70% { box-shadow: 0 0 0 10px rgba(41, 98, 255, 0); }
    100% { box-shadow: 0 0 0 0 rgba(41, 98, 255, 0); }
  }
  /* === Dark mode fixes for exam UI (append to END of style.css) === */

body.dark-mode {
  background: #0f1115;
  color: #e5e7eb;
}

/* Cards/containers */
.dark-mode .box,
.dark-mode .exam-main-panel,
.dark-mode #exam-form .question-block,
.dark-mode .situation-container {
  background: #1b1f2a;
  color: #e5e7eb;
  border-color: #2b3240;
}

/* Choice boxes (default/hover/selected) */
.dark-mode .choice-box {
  background: #111827;
  border-color: #374151;
  color: #e5e7eb;
}
.dark-mode .choice-box:hover {
  background: #0b1220;
}
.dark-mode .choice-box.selected {
  border-color: #60a5fa;
  box-shadow: 0 0 0 2px rgba(59, 130, 246, 0.35) inset;
}

/* After submission states */
.dark-mode .choice-box.correct {
  background: #12351c;          /* deep green */
  border-color: #22c55e;        /* emerald */
  color: #dcfce7;               /* readable on dark green */
}
.dark-mode .choice-box.incorrect {
  background: #3a1212;          /* deep red */
  border-color: #ef4444;        /* red-500 */
  color: #fee2e2;               /* readable on dark red */
}
.dark-mode .correct-answer {
  color: #9ca3af;               /* muted caption text in dark mode */
}

/* Sidebar / controls */
.dark-mode #sidebar-controls {
  background: #0d1321;
  border-color: #2b3240;
}
.dark-mode #sidebar-controls.collapsed #sidebar-content {
  display: none; /* keep collapse behavior consistent */
}
.dark-mode #toggleTrackerBtn,
.dark-mode #submit-btn {
  background: #1e3a8a;
  border-color: #1e3a8a;
  color: #e5e7eb;
}

/* Links in ‚ÄúSolution Links‚Äù */
.dark-mode a {
  color: #93c5fd;
}
.dark-mode a:hover {
  color: #bfdbfe;
}
/* --- Dark mode: make submitted answers readable --- */

/* Base dark surfaces */
body.dark-mode {
  background: #0f1115;
  color: #e5e7eb;
}

/* Question cards / containers */
.dark-mode .situation-container,
.dark-mode .question-block {
  background: #1b1f2a;
  color: #e5e7eb;
  border-color: #2b3240;
}

/* Default choice look in dark */
.dark-mode .choice-box {
  background: #111827;
  border-color: #374151;
  color: #e5e7eb;
}

/* Submitted states: force contrast + remove fading */
.dark-mode .choice-box.correct,
.dark-mode .choice-box.incorrect {
  opacity: 1 !important;              /* prevent dimming */
  color: inherit;
}

.dark-mode .choice-box.correct {
  background: #12351c !important;     /* deep green */
  border-color: #22c55e !important;
  color: #dcfce7 !important;
}
.dark-mode .choice-box.incorrect {
  background: #3a1212 !important;     /* deep red */
  border-color: #ef4444 !important;
  color: #fee2e2 !important;
}

/* Ensure nested text (b, span, MathJax) is readable */
.dark-mode .choice-box.correct * { color: #dcfce7 !important; }
.dark-mode .choice-box.incorrect * { color: #fee2e2 !important; }

/* 'Correct answer:' note under choices */
.dark-mode .correct-answer { color: #9ca3af; }

/* Sidebar buttons on dark */
.dark-mode #toggleTrackerBtn,
.dark-mode #submit-btn {
  background: #1e3a8a;
  border-color: #1e3a8a;
  color: #e5e7eb;
}
 #modeSelector { position: sticky; top: 8px; z-index: 20; display: inline-flex; gap: 8px; }
  #modeSelector button.active { background: #1e3a8a; color: #fff; }
.loading-btn {
  position: relative;
  pointer-events: none;
  opacity: 0.8;
}

.loading-spinner {
  border: 3px solid #f3f3f3;
  border-top: 3px solid #007bff;
  border-radius: 50%;
  width: 16px;
  height: 16px;
  animation: spin 0.8s linear infinite;
  display: inline-block;
  margin-left: 8px;
  vertical-align: middle;
}

@keyframes spin {
  0% { transform: rotate(0deg); }
  100% { transform: rotate(360deg); }
}

/* ======================================================
   FACULTY ANSWER KEY PANEL
====================================================== */

.faculty-tools{
  position: sticky;
  top: 12px;
  z-index: 50;
  padding: 12px;
  margin: 12px 0 18px;
  border-radius: 14px;
  background: #f9fafb;
  border: 1px solid #e5e7eb;
}

body.dark-mode .faculty-tools{
  background: rgba(17,24,39,0.96);
  border-color: #374151;
}

/* Answer key grid */
.answer-key-grid{
  display: grid;
  grid-template-columns: repeat(auto-fill, minmax(88px, 1fr));
  gap: 8px;
  margin-top: 10px;
}

.answer-key-item{
  padding: 6px 10px;
  border-radius: 999px;
  background: #ffffff;
  border: 1px solid #d1d5db;
  font-weight: 700;
  text-align: center;
  color: #1f2937;
}

body.dark-mode .answer-key-item{
  background: #111827;
  border-color: #374151;
  color: #e5e7eb;
}

/* ======================================================
   FACULTY ANSWER HIGHLIGHT (ANS MODE)
====================================================== */

/* All options */
.answer-option{
  margin: 6px 0;
  opacity: 0.7;
}

/* Correct option container */
.answer-correct{
  opacity: 1;
  padding: 10px 14px;
  border-radius: 12px;
  border-left: 4px solid #2563eb;
  background: linear-gradient(
    90deg,
    rgba(37, 99, 235, 0.10),
    rgba(37, 99, 235, 0.02)
  );
}

/* Dark mode correct answer */
body.dark-mode .answer-correct{
  border-left-color: #60a5fa;
  background: linear-gradient(
    90deg,
    rgba(96,165,250,0.18),
    rgba(96,165,250,0.05)
  );
}

/* Correct text */
.answer-correct .highlight-answer{
  color: #1e40af;
  font-weight: 700;
}

body.dark-mode .answer-correct .highlight-answer{
  color: #e0f2fe;
}

/* ANS badge */
.answer-flag{
  margin-left: 10px;
  padding: 2px 10px;
  border-radius: 999px;
  font-size: 0.72em;
  font-weight: 800;
  letter-spacing: 0.12em;
  background: rgba(37,99,235,0.12);
  color: #1d4ed8;
  vertical-align: middle;
}

body.dark-mode .answer-flag{
  background: rgba(96,165,250,0.25);
  color: #93c5fd;
}

/* ======================================================
   DARK MODE ‚Äî clean correct highlight (NO RED, still visible)
   Put this at the VERY END of your CSS
====================================================== */

/* Make sure correct option visually pops (row highlight) */
body.dark-mode .answer-correct{
  opacity: 1;
  padding: 10px 14px;                 /* ensure it has space */
  border-radius: 12px;
  border-left: 4px solid #22d3ee;      /* cyan marker */
  background: rgba(34, 211, 238, 0.10);/* subtle plate */
  box-shadow: 0 0 0 1px rgba(34,211,238,0.18) inset;
}

/* keep correct text readable, but not a red pill */
body.dark-mode .answer-correct .highlight-answer{
  color: #e0f2fe !important;
  background: transparent !important;
  box-shadow: none !important;
  padding: 0 !important;
  border-radius: 0 !important;
}

/* ANS badge */
body.dark-mode .answer-flag{
  margin-left: 10px;
  padding: 2px 10px;
  border-radius: 999px;
  font-size: 0.72em;
  font-weight: 800;
  letter-spacing: 0.12em;
  background: rgba(34,211,238,0.18);
  color: #67e8f9;
  border: 1px solid rgba(34,211,238,0.28);
}

/* fade incorrect options, but keep readable */
body.dark-mode .answer-option{
  opacity: 0.65;
}
body.dark-mode .answer-option.answer-correct{
  opacity: 1;
}

/* ===== HARD OVERRIDE: NO RED HIGHLIGHT IN DARK MODE ===== */
/* Put this at the VERY END of your CSS */

.dark-mode .highlight-answer,
.dark-mode .answer-correct .highlight-answer{
  color: #65e759 !important;      /* calm, readable */
  background: transparent !important;
  box-shadow: none !important;
  border: none !important;
  padding: 0 !important;
  border-radius: 0 !important;
}

/* Dark-mode correct answer should be highlighted by the ROW, not the text */
.dark-mode .answer-correct{
  border-left: 4px solid #22d3ee !important;  /* cyan */
  background: rgba(34,211,238,0.10) !important;
  box-shadow: inset 0 0 0 1px rgba(34,211,238,0.18) !important;
}

.auth-card input{
  width: 100%;
  padding: 10px 12px;
  border-radius: 10px;
  border: 1px solid #cfd3dc;
  outline: none;
  background: #fff;
}

.dark-mode .auth-card input{
  background: #111827;
  border-color: #374151;
  color: #e5e7eb;
}

.auth-grid{ display:flex; flex-direction:column; gap:10px; }

.auth-row{ display:flex; gap:10px; align-items:center; }

.auth-secondary{ background:#444 !important; }

.auth-ghost{
  background: #9aa0a6;
  color: #fff;
  border: none;
  padding: 9px 12px;
  border-radius: 10px;
  cursor: pointer;
}

.auth-danger{ background:#b91c1c !important; }
.auth-danger-wide{
  width: 100%;
  background:#b91c1c;
  color:#fff;
  border:none;
  padding: 10px 12px;
  border-radius: 10px;
  cursor:pointer;
}
/* === Centered auth panel above columns === */
.auth-strip{
  flex: 1 0 100%;
  display: flex;
  justify-content: center;
}

/* Smaller, compact card */
.auth-card.auth-compact{
  width: min(720px, 100%);
  padding: 16px 18px;
}

/* 2-column inputs on desktop, 1-column on mobile */
.auth-two{
  display: grid;
  grid-template-columns: 1fr 1fr;
  gap: 10px;
  margin-top: 12px;
}
@media (max-width: 720px){
  .auth-two{ grid-template-columns: 1fr; }
}

/* Actions row */
.auth-actions{
  display: flex;
  gap: 10px;
  flex-wrap: wrap;
  margin-top: 10px;
}
.auth-actions .exam-btn{ margin-top: 0; }
.auth-actions .auth-ghost{ margin-top: 0; }

/* Details collapsible recovery to reduce height */
.auth-details{
  margin-top: 10px;
  border-top: 1px solid rgba(0,0,0,0.12);
  padding-top: 10px;
}
.dark-mode .auth-details{
  border-top-color: rgba(255,255,255,0.14);
}
.auth-details summary{
  cursor: pointer;
  font-weight: 700;
  display: flex;
  align-items: center;
  gap: 8px;
  color: #18398A;
}
.dark-mode .auth-details summary{
  color: #84aaff;
}

/* OTP layout */
.auth-otp{
  display: grid;
  grid-template-columns: auto 1fr;
  gap: 10px;
  align-items: center;
}
.auth-otp .auth-danger-wide{
  grid-column: 1 / -1;
}
@media (max-width: 720px){
  .auth-otp{ grid-template-columns: 1fr; }
}

/* ‚úÖ Fix input overflow in grid/flex layouts */
.auth-two { 
  min-width: 0; 
}

.auth-two input {
  width: 100%;
  max-width: 100%;
  min-width: 0;              /* allow shrinking inside grid */
  box-sizing: border-box;    /* include padding+border in width */
}
.premium-badge {
  display: none;
  background: linear-gradient(135deg, #facc15, #f97316);
  color: #111;
  font-weight: 700;
  padding: 4px 10px;
  border-radius: 20px;
  font-size: 0.75rem;
  margin-left: 10px;
  letter-spacing: 0.5px;
}

/* Only show if premium */
html[data-premium="true"] .premium-badge {
  display: inline-block;
}
</style>


</head>
<body>
  <header>
  <button class="menu-btn">&#9776;</button>
  <a href="https://ceboardexamgenerator.com" style="display: flex; align-items: center; text-decoration: none; color: white;">
    <img src="assets/webicon.png" class="logo" alt="Logo">
    <h1 style="margin-right: 10px;">CE Board Exam Generator by Engr. Clidez</h1>
  </a>

  <!-- üåô Dark Mode Toggle -->
  <label class="switch" style="margin-left: auto;">
    <input type="checkbox" id="darkToggle">
    <span class="slider"></span>
  </label>

  <nav> 
    <ul class="menu-list">
      <li><a href="index.html">Home</a></li>
       <li><a href="apps.html">Web Applications</a></li>
      <li><a href="about.html">About</a></li>
      <li><a href="contact.html">Contact</a></li>
      <li><a href="blogs.html">Blogs</a></li>
      <li><a href="privacy.html">Privacy</a></li>
      <li class="dropdown">
        <a href="#">Lecture Notes ‚ñ∏</a>
        <ul class="submenu">
          <li><a href="subjects/psad.html">üìò Structural Engineering (PSAD)</a></li>
          <li><a href="subjects/hydraulics.html">üíß Hydraulics Engineering</a></li>
          <li><a href="subjects/geotech.html">ü™® Geotechnical Engineering</a></li>
          <li><a href="subjects/mstc.html">‚öôÔ∏è MSTC (Math, Surveying, etc)</a></li>
        </ul>
      </li>
    </ul>
  </nav>
</header>

<main>
<div class="auth-strip">
  <div class="box auth-card auth-compact">

    <div class="auth-head">
      <h3 style="margin:0;display:flex;align-items:center;gap:10px;">
        <i class="fa-solid fa-user-shield"></i> Account Access
        <span class="premium-badge">PREMIUM</span>
      </h3>

      <p style="margin:6px 0 0;font-size:13px;opacity:0.85;">
        With a one-time payment of Php99.00, remove ads on all pages and access faculty mode.
      </p>
    </div>

    <!-- EMAIL LOGIN (Magic Link ONLY) -->
    <div class="auth-two" style="grid-template-columns: 1fr;">
      <input type="email" id="email" placeholder="Enter your email" autocomplete="email">
    </div>

    <div class="auth-actions">
      <button type="button" class="exam-btn auth-danger" onclick="sendMagicLink()">
        Send Magic Link
      </button>

      <button type="button" class="auth-ghost" onclick="logout()">
        Logout (This Device)
      </button>
    </div>

    <!-- MAGIC LINK NOTICE -->
    <div class="auth-details" style="margin-top:12px;">
      <p style="margin:0 0 8px;font-size:13px;opacity:0.85;">
        Magic link is the only login method. Each time you sign in via magic link, this device becomes the active premium device (floating license).
      </p>
      <p id="logoutAllStatus" style="margin:10px 0 0;font-size:13px;"></p>
    </div>

  </div>
</div>
  <div class="left-column">

    <div class="box exam-main-panel">
     <h1 class="main-title"><i class="fas fa-pen-to-square"></i> CE Board Exam Randomizer</h1> 
      <p class="main-subtitle">
        Instantly generate board exam style exams with randomized questions, shuffled choices, and direct solution links.
      </p>
      <img src="assets/webicon.png" alt="Exam Logo" style="width: 80px; margin: 20px 0;">
     <button class="exam-btn pulse" id="startExamBtn">Generate Exam</button>
    </div>



      <!-- üîΩ INSERTED EXAM UI FROM RENDER -->
      <!-- Mode Selector -->
        <div id="exam-root">
      <div id="modeSelector" style="display:none; text-align:center; margin-bottom: 20px;">
        <h2>Select Mode</h2>
        <button id="studentModeBtn" style="margin:10px; padding:10px 20px;">Use as Student</button>
        <button id="facultyModeBtn" style="margin:10px; padding:10px 20px; background-color:#444; color:white;">Use as Faculty</button>
      </div>

      <!-- Exam Settings -->
      <form id="exam-settings" style="display:none;">
        <label><b>Main Tags:</b></label>
        <div id="mainTagContainer"></div>

        <label><b>Sub Tags:</b></label>
        <div id="subTagContainer"></div>

        <label><b>Number of Situations:</b></label>
        <input type="number" id="situationCount" value="25" min="1" max="75" />
        <button type="submit" id="generateBtn">Generate Exam</button>
      </form>


<div id="loadingNotice" style="display:none; text-align:center; margin-top:10px;">
  <button class="exam-btn loading-btn" disabled>
    Loading Tags...
    <span class="loading-spinner"></span>
  </button>
  <p style="font-size:14px; margin-top:8px;">If this takes long, the server may be waking up.</p>
</div>


      <!-- Exam Layout -->
<div id="exam-layout" style="display:none;">
  <form id="exam-form"></form>

  <div id="sidebar-controls">
    <button id="toggleTrackerBtn" type="button">Hide Controls</button>
    <div id="sidebar-content">
      <div id="situation-tracker-bar"></div>
      <div id="fixed-submit">
        <div id="floating-score"></div>
        <button id="submit-btn" type="button">Submit Answers</button>
      </div>
    </div>
  </div>
</div>

      </div>
  </div>

  <div class="right-column">
      <div class="highlight-box">
        <span style="display: flex; align-items: center;">
          <span style="font-size: 20px; margin-right: 10px;">üìä</span>
          <span>To access our lecture notes and problem sets with solutions, as well as our applications (beam-solver, leveling calculator, etc.), click on the following sections via the hamburger button.</span>
        </span>
        <img src="assets/lecturenoteguide.png" alt="Lecture Note Guide" style="margin-top: 10px; width: 100%; border-radius: 6px;">
        <img src="assets/webappguide.png" alt="Lecture Note Guide" style="margin-top: 10px; width: 100%; border-radius: 6px;">
      </div>

<div class="box">
  <h3>üìÅ Downloadable Files</h3>
  <strong>üìä Mathcad / Excel Files</strong>
  <ul>
    <li><a href="downloads/Singly Reinforced Design (Program).mcdx" download>Singly Reinforced Beam Design (Mathcad)</a></li>
    <li><a href="downloads/Singly Reinforced Analysis (Program).mcdx" download>Singly Reinforced Beam Analysis (Mathcad)</a></li>
     <li><a href="downloads/Surveying Topic 1-4 Reviewer.pdf" download>Surveying Topic 1-4 Reviewer</a></li>
      <li><a href="downloads/Matrix Methods for Member Forces and Deflections in Trusses.xlsx" download>Matrix Methods for Forces and Deflections in Trusses</a></li>
        <li><a href="downloads/Matrix Methods for Frames.pdf" download>Matrix Methods for Reactions and Deflections in Frames</a></li>
               <li><a href="downloads/Matrix Methods for Beams.pdf" download>Matrix Methods for Reactions in Indeterminate Beams</a></li>
                   <li><a href="downloads/Quiz 1 - Surveying.pdf" download>Quiz 1 Surveying 2025</a></li>
     <li><a href="downloads/MDM-forVBA.xlsx" download>Moment Distribution Method Calculator</a></li>
         <li><a href="downloads/DMD and DPD Method Area Computation.xlsx" download>Surveying | DMD and DPD Method Area Calculator</a></li>
  </ul>
</div>

      <div class="box">
        <h4>üé• Animations</h4>
        <p>This section contains instructional videos/engineering animations from my youtube channel.</p>
        <iframe width="100%" height="315" src="https://www.youtube.com/embed/-n2vxErBJXs" frameborder="0" allowfullscreen></iframe>
      </div>
    </div>
  </main>

  <footer>
    &copy; 2025 CE Board Exam Randomizer. All rights reserved.
  </footer>

  <!-- ‚úÖ JavaScript for exam loading -->
  

<script>
  const toggle = document.getElementById('darkToggle');
  toggle.addEventListener('change', () => {
    document.body.classList.toggle('dark-mode');
    localStorage.setItem('dark-mode', document.body.classList.contains('dark-mode'));
  });

  // On load, apply saved mode
  window.addEventListener('DOMContentLoaded', () => {
    const saved = localStorage.getItem('dark-mode') === 'true';
    if (saved) {
      document.body.classList.add('dark-mode');
      toggle.checked = true;
    }
  });
</script>

<script src="script.js"></script>
<script>
  // Collapse/expand the sidebar controls
  (function () {
    const sidebar = document.getElementById('sidebar-controls');
    const toggleBtn = document.getElementById('toggleTrackerBtn');
    if (!sidebar || !toggleBtn) return;

    toggleBtn.addEventListener('click', () => {
      sidebar.classList.toggle('collapsed');
      toggleBtn.textContent = sidebar.classList.contains('collapsed')
        ? 'Show Controls'
        : 'Hide Controls';
    });
  })();
</script>

<script>
  // Wire up Generate ‚Üí choose mode ‚Üí load tags
  window.addEventListener('DOMContentLoaded', () => {
    const startBtn = document.getElementById('startExamBtn');
    const modeSel = document.getElementById('modeSelector');
    const examSettings = document.getElementById('exam-settings');
    // Step 1: show mode picker
    startBtn.addEventListener('click', () => {
      modeSel.style.display = 'block';  // show selector
      startBtn.style.display = 'none';
    });

    // Step 2a: student mode ‚Üí load tags now (KEEP selector visible for instant switching)
    const studentBtn = document.getElementById('studentModeBtn');
    if (studentBtn) {
      studentBtn.addEventListener('click', () => {
        window.isFacultyMode = false;
        examSettings.style.display = 'block';
        if (typeof fetchTags === 'function') fetchTags();
        // NOTE: do NOT hide modeSel here
      });
    }

// Step 2b: faculty mode ‚Üí premium-only
const facultyBtn = document.getElementById('facultyModeBtn');
if (facultyBtn) {
  facultyBtn.addEventListener('click', async () => {
    const ok = await tryEnterFacultyMode();
    if (!ok) return; // modal/message already shown
    window.isFacultyMode = true;
    examSettings.style.display = 'block';
    if (typeof fetchTags === 'function') fetchTags();
  });
}
  });
</script>


<!-- Premium Gate Modal (replaces insecure faculty password modal) -->
<div id="premiumGateModal"
     style="display:none; position:fixed; inset:0; background:rgba(0,0,0,0.55); z-index:1000;">
  <div style="background:#fff; padding:18px; max-width:420px; margin:12% auto; border-radius:12px; text-align:left;">
    <h3 style="margin:0 0 6px;">Premium Feature</h3>
    <p style="margin:0 0 14px; opacity:0.9;">
      <b>Become a premium member to access this feature.</b><br>
      Faculty Mode is available to premium accounts only.
    </p>

    <div style="display:flex; gap:10px; justify-content:flex-end; flex-wrap:wrap;">
      <button type="button" class="exam-btn auth-secondary"
              onclick="document.getElementById('premiumGateModal').style.display='none'">
        Close
      </button>
      <!-- Optional: link to your premium page/checkout -->
      <!-- <a class="exam-btn" href="premium.html">Go Premium</a> -->
    </div>
  </div>
</div>

<!-- Image zoom overlay -->
<div id="img-zoom-overlay">
  <div class="zoom-hint" id="zoom-hint">Scroll to zoom</div>
  <img id="zoomed-img" alt="">
</div>

<script>
async function testSession() {
  const { data: { user } } = await supabaseClient.auth.getUser();

  if (location.hostname === "127.0.0.1" || location.hostname === "localhost") {
    if (user) {
      document.body.insertAdjacentHTML("beforeend",
        `<div style="background:#0f0;padding:10px;">
          Logged in as: ${user.email}
        </div>`
      );
    } else {
      console.log("No user logged in");
    }
  }
}

testSession();
</script>




<script>
/* =========================================================
   AUTH ACTIONS (INDEX PAGE) ‚Äî MAGIC LINK ONLY
   - Users enter EMAIL only
   - Clicking magic link is the ONLY login entry
   - Each successful magic-link login can move the floating license to this device
   ========================================================= */

async function sendMagicLink() {
  const emailEl = document.getElementById("email");
  const email = (emailEl ? emailEl.value : "").trim();

  if (!email) return setAuthStatus("Please enter your email first.", true);

  // Add a cache-buster to avoid some email clients / browsers reusing old callbacks
  const u = new URL(window.location.href);
  u.searchParams.set("t", String(Date.now()));

  setAuthStatus("Sending magic link...");

  // Mark that THIS browser initiated a magic-link login (used to allow floating-license takeover even if URL params are stripped)
  try { localStorage.setItem("magic_intent_ts", String(Date.now())); } catch (e) {}

  const { error } = await supabaseClient.auth.signInWithOtp({
    email,
    options: {
      shouldCreateUser: true, // allow email-only signup
      emailRedirectTo: u.toString()
    }
  });

  if (error) return setAuthStatus(error.message, true);
  setAuthStatus("Magic link sent. Check your email and click the link to continue.");
}

async function logout() {
  const localToken = localStorage.getItem("device_session_id");
  const { data: { user } } = await supabaseClient.auth.getUser();

  // Clear DB token ONLY if this device currently owns it
  if (user && localToken) {
    await supabaseClient
      .from("profiles")
      .update({ current_session_id: null })
      .eq("id", user.id)
      .eq("current_session_id", localToken);
  }

  localStorage.removeItem("device_session_id");
  try { sessionStorage.removeItem("just_authed_ts"); } catch (e) {}
  try { sessionStorage.removeItem("signed_in_ts"); } catch (e) {}
  try { localStorage.removeItem("magic_intent_ts"); } catch (e) {}
  await supabaseClient.auth.signOut();

  document.documentElement.dataset.premium = "false";
  loadAds();

  setAuthStatus("Logged out on this device.");
  window.location.reload();
}
</script>

<script>
// Single, canonical premium gate opener (used by tryEnterFacultyMode)
function showPremiumGate() {
  const modal = document.getElementById("premiumGateModal");
  if (modal) modal.style.display = "block";
  else alert("Premium Feature: Become a premium member to access this feature.");
}
</script>

</body>
</html>
